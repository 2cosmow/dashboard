<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step by Step</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --background-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-primary: #2b2d42;
            --text-secondary: #6c757d;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2rem;
            margin: 0;
            font-weight: 600;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .card p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .button {
            background: var(--primary-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
            width: auto;
            min-width: 120px;
        }

        .button:hover {
            background: var(--secondary-color);
        }

        .back-button {
            background: var(--text-secondary);
            margin-top: 1rem;
        }

        .checkbox-container {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .checkbox-container div {
            margin: 0.8rem 0;
            display: flex;
            align-items: center;
        }

        input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        input[type="date"], textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 0.5rem 0;
            font-size: 1rem;
        }

        #countdown {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            text-align: center;
            margin: 1.5rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        #progressChart {
            height: 400px;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .card {
                padding: 1rem;
            }

            .grid-container {
                gap: 1rem;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 0.8rem;
            }

            #countdown {
                font-size: 1.4rem;
            }
        }

        .notes-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .note-card {
            background: #f8f9fa;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .note-date {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
   <div class="header">
        <h1>Step by Step</h1>
    </div>
    <div id="mainView" class="grid-container">
        <div class="card">
            <h2>Countdown all'Esame</h2>
            <p>Scopri quanto tempo manca all'esame.</p>
            <button class="button" onclick="showCountdown()">Vai</button>
        </div>
        <div class="card">
            <h2>Grafico dei Miglioramenti</h2>
            <p>Visualizza i tuoi progressi.</p>
            <button class="button" onclick="showProgress()">Vai</button>
        </div>
        <div class="card">
            <h2>Routine Giornaliera</h2>
            <p>Organizza e monitora la tua giornata.</p>
            <button class="button" onclick="showRoutine()">Vai</button>
        </div>
        <div class="card">
            <h2>Note Personali</h2>
            <p>Scrivi e visualizza le tue note personali.</p>
            <button class="button" onclick="showNotes()">Vai</button>
        </div>
        <div class="card">
            <h2>Riepilogo Settimanale</h2>
            <p>Controlla i tuoi progressi settimanali.</p>
            <button class="button" onclick="showWeekly()">Vai</button>
        </div>
        <div class="card">
            <h2>Modifica Data Countdown</h2>
            <p>Imposta una nuova data per il countdown.</p>
            <button class="button" onclick="showDateModify()">Vai</button>
        </div>
    </div>

<div id="routineView" style="display: none">
    <div class="card">
        <h2>Routine Giornaliera</h2>
        <div class="checkbox-container">
            <label for="task1">
                <input type="checkbox" id="task1" name="task1" value="2.5"> Lettura Approfondita (2.5)
            </label><br>
            <label for="task2">
                <input type="checkbox" id="task2" name="task2" value="2.0"> Schema Argomenti (2.0)
            </label><br>
            <label for="task3">
                <input type="checkbox" id="task3" name="task3" value="1.5"> Leggere Appunti (1.5)
            </label><br>
            <label for="task4">
                <input type="checkbox" id="task4" name="task4" value="1.0"> Ripasso Veloce (1.0)
            </label><br>
        </div>
        <button type="button" class="button" onclick="saveRoutine()">Salva</button>
        <button type="button" class="back-button" onclick="showMain()">Torna alla Dashboard</button>
    </div>
</div>

    <div id="countdownView" style="display: none">
        <div class="card">
            <h2>Countdown all'Esame</h2>
            <div id="countdown" style="font-size: 24px; margin: 20px;"></div>
            <button class="back-button" onclick="showMain()">Torna alla Dashboard</button>
        </div>
    </div>

    <div id="progressView" style="display: none">
        <div class="card">
            <h2>Grafico dei Miglioramenti</h2>
            <div id="progressChart" style="height: 400px;"></div>
            <button class="back-button" onclick="showMain()">Torna alla Dashboard</button>
        </div>
    </div>

    <div id="weeklyView" style="display: none">
        <div class="card">
            <h2>Riepilogo Settimanale</h2>
            <table id="weeklyTable">
                <thead>
                    <tr>
                        <th>Settimana</th>
                        <th>Totale Punteggio</th>
                        <th>Media Punteggio</th>
                        <th>Attivit√† Frequente</th>
                        <th>Trend</th>
                    </tr>
                </thead>
                <tbody id="weeklyTableBody"></tbody>
            </table>
            <button class="back-button" onclick="showMain()">Torna alla Dashboard</button>
        </div>
    </div>

    <div id="notesView" style="display: none">
        <div class="card">
            <h2>Note Personali</h2>
            <textarea id="noteInput" name="noteInput" style="width: 100%; height: 200px; margin: 10px 0; padding: 10px;"></textarea>
            <button class="button" onclick="saveNote()">Aggiungi Nota</button>
            <div id="notesList" style="margin-top: 20px; text-align: left;"></div>
            <button class="back-button" onclick="showMain()">Torna alla Dashboard</button>
        </div>
    </div>

    <div id="dateModifyView" style="display: none">
        <div class="card">
            <h2>Modifica Data del Countdown</h2>
            <input type="date" id="newExamDate" name="newExamDate" class="date-input">
            <button class="button" onclick="saveNewDate()">Salva</button>
            <button class="back-button" onclick="showMain()">Torna alla Dashboard</button>
        </div>
    </div>

    <script>
        let routineData = {};
        let examDate = new Date('2024-02-15');
        let notes = [];

        // View Functions
        function showMain() {
            document.getElementById('mainView').style.display = 'grid';
            ['routineView', 'countdownView', 'progressView', 'weeklyView', 'notesView', 'dateModifyView'].forEach(view => {
                document.getElementById(view).style.display = 'none';
            });
        }

        function showRoutine() {
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('routineView').style.display = 'block';
        }

        function showCountdown() {
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('countdownView').style.display = 'block';
            updateCountdown();
        }

        function showProgress() {
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('progressView').style.display = 'block';
            updateProgressChart();
        }

        function showWeekly() {
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('weeklyView').style.display = 'block';
            updateWeeklySummary();
        }

        function showNotes() {
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('notesView').style.display = 'block';
            displayNotes();
        }

        function showDateModify() {
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('dateModifyView').style.display = 'block';
        }

        // Functionality
        function saveRoutine() {
            const today = new Date().toISOString().split('T')[0];
            let dailyScore = 0;
            let activities = [];
            
            document.querySelectorAll('.checkbox-container input:checked').forEach(checkbox => {
                dailyScore += parseFloat(checkbox.value);
                activities.push(checkbox.id);
            });

            if (!routineData[today]) {
                routineData[today] = [];
            }
            routineData[today].push({
                score: dailyScore,
                activities: activities
            });

            localStorage.setItem('routineData', JSON.stringify(routineData));
            alert('Attivit√† salvate con successo!');
            updateWeeklySummary();
            updateProgressChart();
        }

        function updateCountdown() {
            const now = new Date();
            const diff = examDate - now;
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('countdown').innerHTML = 
                days + ' giorni, ' + hours + ' ore, ' + 
                minutes + ' minuti, ' + seconds + ' secondi';
            
            setTimeout(updateCountdown, 1000);
        }

function updateProgressChart() {
    // Funzioni helper per le date
    const getCurrentItalianDate = () => {
        const now = new Date();
        return new Date(now.getTime() + (1 * 60 * 60 * 1000)).toISOString().split('T')[0];
    };

    const generateLast30Days = () => {
        let dates = [];
        for (let i = 29; i >= 0; i--) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            dates.push(date.toISOString().split('T')[0]);
        }
        return dates;
    };

    // Calcola il punteggio e determina il colore
    const getScoreAndColor = (date) => {
        const score = !routineData[date] ? 0 : 
            routineData[date].reduce((sum, entry) => sum + entry.score, 0);
        
        // Scala di colori basata sul punteggio
        if (score === 0) return { score, color: '#e2e8f0' };  // Grigio chiaro per 0
        if (score < 3) return { score, color: '#60a5fa' };    // Blu chiaro per basso
        if (score < 6) return { score, color: '#3b82f6' };    // Blu medio per medio
        return { score, color: '#1d4ed8' };                   // Blu scuro per alto
    };

    const dates = generateLast30Days();
    const scoreData = dates.map(date => getScoreAndColor(date));
    
    // Calcola la media mobile a 7 giorni per la linea di trend
    const movingAverage = scores => {
        return scores.map((_, idx, arr) => {
            const start = Math.max(0, idx - 6);
            const values = arr.slice(start, idx + 1).map(v => v.score);
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            return avg;
        });
    };

    const traces = [
        // Barre
        {
            x: dates.map((_, i) => `t${i}`),
            y: scoreData.map(d => d.score),
            type: 'bar',
            name: 'Punteggio',
            marker: {
                color: scoreData.map(d => d.color)
            },
            hovertemplate: `Data: %{customdata}<br>Punteggio: %{y}<extra></extra>`,
            customdata: dates
        },
        // Linea di trend
        {
            x: dates.map((_, i) => `t${i}`),
            y: movingAverage(scoreData),
            type: 'scatter',
            mode: 'lines',
            name: 'Media 7 giorni',
            line: {
                color: '#475569',
                width: 2,
                dash: 'dot'
            },
            hovertemplate: 'Media: %{y:.1f}<extra></extra>'
        }
    ];

    const layout = {
        title: {
            text: 'Progresso Giornaliero',
            font: {
                size: 20
            }
        },
        xaxis: {
            title: 'Tempo (giorni)',
            showgrid: false,
            tickangle: -45,
            tickfont: {
                size: 10
            }
        },
        yaxis: {
            title: 'Punteggio Totale', 
            range: [0, 9],
            showgrid: true,
            gridcolor: '#f0f0f0',
            zeroline: true,
            zerolinecolor: '#cbd5e0'
        },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        displayModeBar: false,
        margin: {
            l: 50,
            r: 20,
            t: 40,
            b: 80
        },
        showlegend: true,
        legend: {
            orientation: 'h',
            yanchor: 'bottom',
            y: 1.02,
            xanchor: 'right',
            x: 1
        },
        hovermode: 'x unified'
    };

    const config = {
        displayModeBar: false,
        responsive: true,
        staticPlot: false  // Permettiamo l'interazione per i tooltip
    };

    Plotly.newPlot('progressChart', traces, layout, config);
}
        function updateWeeklySummary() {
            const weeklyData = {};
            Object.entries(routineData).forEach(([date, entries]) => {
                const week = getWeekNumber(new Date(date));
                if (!weeklyData[week]) {
                    weeklyData[week] = {
                        totalScore: 0,
                        days: 0,
                        activities: {}
                    };
                }
                
                entries.forEach(entry => {
                    weeklyData[week].totalScore += entry.score;
                    entry.activities.forEach(activity => {
                        weeklyData[week].activities[activity] = 
                            (weeklyData[week].activities[activity] || 0) + 1;
                    });
                });
                weeklyData[week].days++;
            });

            const tbody = document.getElementById('weeklyTableBody');
            tbody.innerHTML = '';
            
            Object.entries(weeklyData).forEach(([week, data]) => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = 'Settimana ' + week;
                row.insertCell(1).textContent = data.totalScore.toFixed(2);
                row.insertCell(2).textContent = (data.totalScore / data.days).toFixed(2);
                
                const mostFrequent = Object.entries(data.activities)
                    .sort((a, b) => b[1] - a[1])[0];
                row.insertCell(3).textContent = mostFrequent ? mostFrequent[0] : 'N/A';
                row.insertCell(4).textContent = 'N/A';
            });
        }

        function saveNote() {
            const noteText = document.getElementById('noteInput').value;
            if (noteText.trim()) {
                notes.push({
                    text: noteText,
                    date: new Date().toISOString()
                });
                localStorage.setItem('notes', JSON.stringify(notes));
                document.getElementById('noteInput').value = '';
                displayNotes();
            }
        }

        function displayNotes() {
            const notesList = document.getElementById('notesList');
            notesList.innerHTML = notes
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(note => `<div style="margin: 10px 0; padding: 10px; border: 1px solid #e2e8f0;">
                    <div style="font-size: 0.8em; color: #718096;">
                        ${new Date(note.date).toLocaleString()}
                    </div>
                    <div style="margin-top: 5px;">${note.text}</div>
                </div>`)
                .join('');
        }

        function saveNewDate() {
            const newDate = document.getElementById('newExamDate').value;
            if (newDate) {
                examDate = new Date(newDate);
                localStorage.setItem('examDate', newDate);
                alert('Data aggiornata con successo!');
                showMain();
            }
        }

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
        }

        // Load saved data on page load
        window.onload = function() {
    const savedRoutine = localStorage.getItem('routineData');
    if (savedRoutine) {
        routineData = JSON.parse(savedRoutine);
    }

    const savedNotes = localStorage.getItem('notes');
    if (savedNotes) {
        notes = JSON.parse(savedNotes);
    }

    const savedDate = localStorage.getItem('examDate');
    if (savedDate) {
        examDate = new Date(savedDate);
    }

    showMain();
};
    </script>
</body>
</html>
